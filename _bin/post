#!/usr/bin/env ruby
#
# This file was generated by Bundler.
#
# The application 'jekyll' is installed as part of a gem, and
# this file is here to facilitate running it.
#

require 'pathname'
ENV['BUNDLE_GEMFILE'] ||= File.expand_path("../../Gemfile",
  Pathname.new(__FILE__).realpath)

require 'rubygems'
require 'bundler/setup'

require "thor"
require "stringex"

class Post < Thor
  desc "new", "create a new post"

  method_option :editor, default: "e"
  method_option :date, default: Time.now.strftime('%Y-%m-%d')

  def new(*title)
    title = title.join(" ")
    filename = "_posts/#{options[:date]}-#{title.to_url}.md"

    if File.exist?(filename)
      abort("#{filename} already exists!")
    end

    puts "Creating new post: #{filename}"
    open(filename, 'w') do |post|
      post.puts "---"
      post.puts "layout: post"
      post.puts "title: \"#{title.gsub(/&/,'&amp;')}\""
      post.puts "date: #{options[:date]}"
      post.puts "tags:"
      post.puts "---"
    end

    system(options[:editor], filename)
  end
end

Post.start(ARGV)
