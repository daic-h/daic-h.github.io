---
title: Go generate コマンド
---

こんにちは。開発部の平田です。

今回はGolangのgenerateコマンドと、それをアプリケーション開発でどの様に活用していくかの例を簡単に紹介したいと思います。

## Generate

Golangにはgenerateというコマンドがあります。generateという名前ではありますが、このコマンド自体には何かを生成・出力する機能はありません。このコマンドはGoのソースコード内の専用のフォーマットで書かれたコメントをスキャンし、そこに書かれているコマンドを実行する為のコマンドです。

機能だけ聞くと用途が分かりづらいですが、Goのコードからユーティリティ関数を生成したり、何らかの定義ファイル(.protoや.yなど)からコードを生成するのに必要なコマンドを実行する事が想定されています。

公式に用意されているstringerというツールを例に上げると、

``` go
package main

import "fmt"

//go:generate stringer -type=Lang
type Lang int

const (
	Go Lang = iota
	Java
	Ruby
	Perl
)

func main() {
	var lang Lang = Go

	fmt.Println(lang)
}
```

このようなファイルに対してそのまま実行すると`0`が出力されます。ここで、go generateコマンドを実行することで`lang_string.go`というファイルが生成されます。

``` go
// Code generated by "stringer -type=Lang"; DO NOT EDIT

package main

import "fmt"

const _Lang_name = "GoJavaRubyPerl"

var _Lang_index = [...]uint8{0, 2, 6, 10, 14}

func (i Lang) String() string {
	if i < 0 || i >= Lang(len(_Lang_index)-1) {
		return fmt.Sprintf("Lang(%d)", i)
	}
	return _Lang_name[_Lang_index[i]:_Lang_index[i+1]]
}
```

出力されたファイルに`func (i Lang) String() string`が定義されるので、再度実行すると`Go`と出力されると思います。この様にコードとして出力されるので、リフレクションと違ってコンパイルの恩恵をうけることが出来、パフォーマンス的にも

この様に、ソースコードを元に機械的な処理を行うにはstringerのようなツールを作る必要があり、generateコマンドはその補助に過ぎません。

それではアプリケーション固有の処理を機械的に生成したい場合、どの様にして作れば良いのでしょうか。実際の所、どの様に作ってもかまわないのですが、今回は`ast`パッケージを使って簡単なツールを作成してみたいと思います。

## Ast

